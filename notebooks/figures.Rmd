---
title: "Paper figures - circuit models"
output: html_notebook
---

# Libraries and helpers
```{r helper_fns, echo=FALSE, fig.width=6, fig.height=4, echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(grid)
library(gridExtra)
library(plyr)
library(readr)
library(dplyr)
library(png)
library(psd)
library(tidyr)
library(patchwork)
```

# Load data
```{r load1, message=FALSE, warning=FALSE, error=FALSE}
# -- num_pop search-----------------------------------------------------------
# dMI (choose stim_rate, sweep g)
stim_rates <- c('1', '2', '3', '4')
num_pops <- c('40', '80', '160', '320', '640', '1280', '2560', '5120', '10240')

# exp4
path <- "~/Code/theagamma/data/exp4/"
dmi_exp4 <- NULL
for(stim_rate in stim_rates){
  for (num_pop in num_pops) {
    file_name <-
      paste(
        path,
        "sample",
        stim_rate,
        "_",
        num_pop,
        "_dMI.csv",
        sep = ""
      )
    df <- read.csv(file_name)
    df$stim_rate <- as.numeric(stim_rate)
    df$model <- "ING"
    dmi_exp4 <- bind_rows(df, dmi_exp4)
  }
}

# exp5
path <- "~/Code/theagamma/data/exp5/"

dmi_exp5 <- NULL
for(stim_rate in stim_rates){
  for (num_pop in num_pops) {
    file_name <-
      paste(
        path,
        "sample",
        stim_rate,
        "_",
        num_pop,
        "_dMI.csv",
        sep = ""
      )
    df <- read.csv(file_name)
    df$stim_rate <- as.numeric(stim_rate)
    df$model <- "PING"
    dmi_exp5 <- bind_rows(df, dmi_exp5)
  }
}

# exp6
path <- "~/Code/theagamma/data/exp6/"
dmi_exp6 <- NULL
for(stim_rate in stim_rates){
  for (num_pop in num_pops) {
    file_name <-
      paste(
        path,
        "sample",
        stim_rate,
        "_",
        num_pop,
        "_dMI.csv",
        sep = ""
      )
    df <- read.csv(file_name)
    df$stim_rate <- as.numeric(stim_rate)
    df$model <- "CHING"
    dmi_exp6 <- bind_rows(df, dmi_exp6)
  }
}

# -- num_pop = big and small 
# ING
gs <- c('3', '3.5', '4', '4.5', '5', '5.5', '6.0', '6.5', '7.0')
stim_rates <- c('0.5', '1', '1.5', '2.0', '2.5', '3.0')
num_pops <- c('1280', '10240')

path <- "~/Code/theagamma/data/exp18/"
dmi_exp18 <- NULL
for(g in gs){
  for(stim_rate in stim_rates){
    for (num_pop in num_pops) {
      file_name <-
        paste(path,
              "sample-g",
              g,
              "-s",
              stim_rate,
              "_",
              num_pop,
              "_dMI.csv",
              sep = "")
      df <- read.csv(file_name)
      df$g <- as.numeric(g)
      df$stim_rate <- as.numeric(stim_rate)
      df$model <- "ING"
      df$g_code <- "g_I"
      dmi_exp18 <- bind_rows(df, dmi_exp18)
    }
  }
}

# PING - g_ei
gs <- c('0.6', '0.7', '0.8', '0.9', '1.0', '1.1', '1.2', '1.3', '1.4')
stim_rates <- c('0.5', '1', '1.5', '2.0', '2.5', '3.0')
num_pops <- c('1280', '10240')

path <- "~/Code/theagamma/data/exp20/"
dmi_exp20 <- NULL
for(g in gs){
  for(stim_rate in stim_rates){
    for (num_pop in num_pops) {
      file_name <-
        paste(path,
              "sample-g",
              g,
              "-s",
              stim_rate,
              "_",
              num_pop,
              "_dMI.csv",
              sep = "")
      df <- read.csv(file_name)
      df$g <- as.numeric(g)
      df$stim_rate <- as.numeric(stim_rate)
      df$model <- "PING"
      df$g_code <- "g_EI"
      dmi_exp20 <- bind_rows(df, dmi_exp20)
    }
  }
}

# PING - g_ie
gs <- c('3', '3.5', '4', '4.5', '5', '5.5', '6.0', '6.5', '7.0') 
stim_rates <- c('0.5', '1', '1.5', '2.0', '2.5', '3.0')
num_pops <- c('1280', '10240')

path <- "~/Code/theagamma/data/exp22/"
dmi_exp22 <- NULL
for(g in gs){
  for(stim_rate in stim_rates){
    for (num_pop in num_pops) {
      file_name <-
        paste(path,
              "sample-g",
              g,
              "-s",
              stim_rate,
              "_",
              num_pop,
              "_dMI.csv",
              sep = "")
      df <- read.csv(file_name)
      df$g <- as.numeric(g)
      df$stim_rate <- as.numeric(stim_rate)
      df$model <- "PING"
      df$g_code <- "g_IE"
      dmi_exp22 <- bind_rows(df, dmi_exp22)
    }
  }
}

# CHING - g_e
gs <- c('0.6', '0.7', '0.8', '0.9', '1.0', '1.1', '1.2', '1.3', '1.4')
stim_rates <- c('0.5', '1', '1.5', '2.0', '2.5', '3.0')
num_pops <- c('160', '10240')

path <- "~/Code/theagamma/data/exp24/"
dmi_exp24 <- NULL
for(g in gs){
  for(stim_rate in stim_rates){
    for (num_pop in num_pops) {
      file_name <-
        paste(path,
              "sample-g",
              g,
              "-s",
              stim_rate,
              "_",
              num_pop,
              "_dMI.csv",
              sep = "")
      df <- read.csv(file_name)
      df$g <- as.numeric(g)
      df$stim_rate <- as.numeric(stim_rate)
      df$model <- "CHING"
      df$g_code <- "g_E"
      dmi_exp24 <- bind_rows(df, dmi_exp24)
    }
  }
}
```


# Figure - Examples 
# ^TODO
```{r, fig.width=3, fig.height=5.4, echo=FALSE, warning=FALSE, message=FALSE}
examples <- read_csv("../data/examples.csv")

# S
examples %>% 
  ggplot(aes(x=times, y=stim_ref)) +
  geom_line(color="darkgrey", size=1.1) +
  scale_y_continuous(breaks=c(0, 0.5, 1), limits=c(0, 1)) +
  theme_classic2() + 
  labs(x="", y="Norm. rate", tag="a.", title="Stimulus") + 
  theme(plot.title = element_text(size = 9, face = "bold")) ->
p4

examples %>% 
  select(stim_ref) %>% 
 welchPSD(seglength=1000) -> spec
spec <- data.frame(frequency=spec$frequency*1000, power=spec$power)
spec %>% 
  filter(frequency < 25) %>% 
ggplot(aes(x=frequency, y=log10(power))) +
  geom_line(size=0.8, color="darkgrey") +
  labs(x="", y="Power", tag="h.") +
  lims(y=c(-3,2)) +
  theme_classic2() +
  theme(plot.title = element_text(size = 9, hjust=1, face = "bold")) -> s4

# O
examples %>% 
  ggplot(aes(x=times, y=osc_p)) +
  geom_line(aes(x=times, y=osc_ref), color="darkgrey") +
  geom_line(size=1.2) +
  scale_y_continuous(breaks=c(0, 0.5, 1), limits=c(0, 1)) +
  theme_classic2() + 
  labs(x="", y="Norm. rate", tag="c.", title="Pacemaker (O)") +
  theme(plot.title = element_text(size = 9, face = "bold")) ->
p5

examples %>% 
  select(osc_p) %>% 
 welchPSD(seglength=1000) -> spec
spec <- data.frame(frequency=spec$frequency*1000, power=spec$power)
spec %>% 
  filter(frequency < 25) %>% 
ggplot(aes(x=frequency, y=log10(power))) +
  geom_line(size=0.8) +
  labs(x="", y="Power", tag="j.") +
  lims(y=c(-3,2.1)) +
  theme_classic2() -> s5


# S
examples %>% 
  ggplot(aes(x=times, y=stim_p)) +
  geom_line() +
  # geom_line(aes(x=times, y=stim_ref), color="darkgrey", size=1.1) +
  scale_y_continuous(breaks=c(0, 0.5, 1), limits=c(0, 1)) +
  theme_classic2() + 
  labs(x="", y="Norm. rate", tag="b.",  title="Unmodulated (S)") +
  theme(plot.title = element_text(size = 9, face = "bold")) ->
p9

examples %>% 
  select(stim_p) %>% 
 welchPSD(seglength=1000) -> spec
spec <- data.frame(frequency=spec$frequency*1000, power=spec$power)
spec %>% 
  filter(frequency < 25) %>% 
ggplot(aes(x=frequency, y=log10(power))) +
  geom_line(size=0.8, color="black") +
  labs(x="", y="Power", tag="i.") +
  lims(y=c(-3,2)) +
  theme_classic2() -> s9

# EI
examples %>% 
  ggplot(aes(x=times, y=mult_p)) +
  geom_line() +
  # geom_line(aes(x=times, y=stim_ref), color="darkgrey", size=1.1) +
  scale_y_continuous(breaks=c(0, 0.5, 1), limits=c(0, 1)) +
  theme_classic2() + 
  labs(x="", y="Norm. rate", tag="e.", title="Multiplicative (EI)") +
  theme(plot.title = element_text(size = 9, face = "bold")) -> 
p6

examples %>% 
  select(mult_p) %>% 
 welchPSD(seglength=1000) -> spec
spec <- data.frame(frequency=spec$frequency*1000, power=spec$power)
spec %>% 
  filter(frequency < 25) %>% 
ggplot(aes(x=frequency, y=log10(power))) +
  geom_line(size=0.8, color="black") +
  labs(x="", y="Power", tag="l.") +
  lims(y=c(-3,2)) +
  theme_classic2() -> s6

# E
examples %>% 
  ggplot(aes(x=times, y=add_p)) +
  geom_line() +
  # geom_line(aes(x=times, y=stim_ref), color="darkgrey", size=1.1) +
  scale_y_continuous(breaks=c(0, 0.5, 1), limits=c(0, 1)) +
  theme_classic2() + 
  labs(x="", y="Norm. rate", tag="d.", title="Additive (E)") +
  theme(plot.title = element_text(size = 9, face = "bold")) ->
p7

examples %>% 
  select(add_p) %>% 
 welchPSD(seglength=1000) -> spec
spec <- data.frame(frequency=spec$frequency*1000, power=spec$power)
spec %>% 
  filter(frequency < 25) %>% 
ggplot(aes(x=frequency, y=log10(power))) +
  geom_line(size=0.8, color="black") +
  labs(x="", y="Power", tag="k.") +
  lims(y=c(-3,2)) +
  theme_classic2() -> s7


# I
examples %>% 
  ggplot(aes(x=times, y=sub_p)) +
  geom_line() +
  # geom_line(aes(x=times, y=stim_ref), color="darkgrey", size=1.2) +
  scale_y_continuous(breaks=c(0, 0.5, 1), limits=c(0, 1)) +
  theme_classic2() + 
  labs(x="", y="Norm. rate", tag="f.", title="Subtractive (I)") +
  theme(plot.title = element_text(size = 9, face = "bold")) ->
p8

examples %>% 
  select(sub_p) %>% 
 welchPSD(seglength=1000) -> spec
spec <- data.frame(frequency=spec$frequency*1000, power=spec$power)
spec %>% 
  filter(frequency < 25) %>% 
ggplot(aes(x=frequency, y=log10(power))) +
  geom_line(size=0.8, color="black") +
  labs(x="", y="Power", tag="m.") +
  lims(y=c(-3,2)) +
  theme_classic2() -> s8

# II
examples %>% 
  ggplot(aes(x=times, y=div_sub_p)) +
  geom_line() +
  scale_y_continuous(breaks=c(0, 0.5, 1), limits=c(0, 1)) +
  labs(x="Time (s)", y="Norm. rate", tag="g.", title="Subtractive/divisive (II)") +
  theme_classic2() + 
  theme(plot.title = element_text(size = 9, face = "bold")) ->
p10

examples %>% 
  select(div_sub_p) %>% 
 welchPSD(seglength=1000) -> spec
spec <- data.frame(frequency=spec$frequency*1000, power=spec$power)
spec %>% 
  filter(frequency < 25) %>% 
ggplot(aes(x=frequency, y=log10(power))) +
  geom_line(size=0.8, color="black") +
  labs(x="Frequency (Hz)", y="Power", tag="n.") +
  lims(y=c(-3,2)) +
  theme_classic2() -> s10

# --------------------------------------------------------------------  
((p4 / p9 / p5 / p7 / p6 / p8 / p10) | (s4 / s9 / s5 / s7 / s6 / s8 / s10)) +
  plot_layout(width = c(0.75, 0.25)) +
  # plot_annotation(tag_levels = 'a', tag_suffix = ".")
ggsave("figures/example.pdf", dpi=300, width=2*3, height=2*5.4)
ggsave("figures/example.png", dpi=300, width=2*3, height=2*5.4)
```

# Figure - num_pop - circuit 1 
```{r, fig.width=8, fig.height=3, echo=FALSE, warning=FALSE, message=FALSE}
tmp1 <- NULL
tmp1 <- bind_rows(dmi_exp4, tmp1)
tmp1 <- bind_rows(dmi_exp5, tmp1)
tmp1 <- bind_rows(dmi_exp6, tmp1)
tmp1$model <- factor(tmp1$model, levels=c("ING", "PING", "CHING"))

# -----------------------------------------------
# Jitter all
tmp1 %>% 
  filter(stim_rate == 1) %>%
  ggplot(aes(x=model, y=E)) +
  geom_jitter(size=.1, alpha=0.4, width=0.3) +
  stat_summary(aes(group=model), fun.y=mean,
               geom="point", colour="black", alpha=1, size=14, shape="_") +
  geom_hline(yintercept=0, color="dark grey", size=0.5) + xlab("") +
  labs(y=expression(paste(Delta, "MI (bits)")), x="Model", title="") +
  theme_classic() + 
  theme(plot.title = element_text(size = 7, hjust=3, face = "bold")) -> 
  p1
# print(p1)

# -----------------------------------------------
# Num. pop. sequence
tmp1 %>%
  filter(stim_rate == 1) %>% 
  group_by(model, num_pop) %>%
  summarise(M=mean(E),
            SD=sd(E)) -> 
  tmp2
tmp2$model <- factor(tmp2$model, levels=c("ING", "PING", "CHING"))

tmp2 %>% 
  # ggplot(aes(x=num_pop,  y=m, color=factor(g), group=factor(g))) +
  ggplot(aes(x=as.numeric(num_pop), y=M)) +
  geom_line(size=0.7, alpha=1) +
  geom_ribbon(aes(ymin=M-SD, ymax=M+SD), alpha=0.2, color=NA) +
  geom_hline(yintercept=0, color="dark grey") + xlab("") +
  scale_x_log10() +
  annotation_logticks(sides="b") + 
  labs(y=expression(paste(Delta, "MI (bits)")), x="Population size") +
  theme_classic() +
  theme(strip.background = element_blank()) +
  theme(legend.background = element_rect(colour ="black")) +
  theme(legend.key.size = unit(.3, "cm")) +
  theme(panel.spacing = unit(1, "lines")) +
  theme(strip.text.x = element_text(face = "bold")) +
  facet_grid(.~model) ->
  p2
print(p2)

# -----------------------------------------------
# Build figure
p1 + p2 + plot_layout(widths = c(0.2, 0.8)) +
  plot_annotation(tag_levels = 'a', tag_suffix = ".")
ggsave("figures/circuit1.pdf", dpi=300, width = 8, height = 3)
ggsave("figures/circuit1.png", dpi=300, width = 8, height = 3)
```

# Figure - small - stim/g
```{r, fig.width=9, fig.height=7, echo=FALSE, warning=FALSE, message=FALSE}
tmp1 <- NULL
tmp1 <- bind_rows(dmi_exp18, tmp1)
tmp1 <- bind_rows(dmi_exp20, tmp1)
tmp1 <- bind_rows(dmi_exp22, tmp1)
tmp1 <- bind_rows(dmi_exp24, tmp1)
tmp1$model <- factor(tmp1$model, levels=c("ING", "PING", "CHING"))

# -----------------------------------------------
# Jitter all
tmp %>% 
  filter(num_pop < 10240) %>% 
  ggplot(aes(x=model, y=E)) +
  geom_jitter(size=0.8, alpha=0.4, width=0.25) +
  stat_summary(aes(group=model), fun.y=mean,
               geom="point", colour="black", alpha=1, size=15, shape="_") +
  geom_hline(yintercept=0, color="dark grey", size=0.5) + xlab("") +
  labs(y=expression(paste(Delta, "MI (bits)")), x="Model", title="") +
  theme_classic() + 
  theme(plot.title = element_text(size = 7, hjust=3, face = "bold")) -> 
  p1
print(p1)

# -----------------------------------------------
## stim_rate sequence

tmp1 %>%
  group_by(model, num_pop, g_code, g, stim_rate) %>%
  summarise(M=mean(E),
            SD=sd(E)) -> 
  tmp2
tmp2$model <- factor(tmp2$model, levels=c("ING", "PING", "CHING"))

# ING
tmp2 %>% 
  filter(num_pop < 10240) %>% 
  filter(model == "ING") %>% 
  ggplot(aes(x=stim_rate,  y=M, color=factor(g), group=factor(g))) +
  geom_line(size=1.5, alpha=1) +
  geom_ribbon(aes(
    ymin = M - SD,
    ymax = M + SD,
    fill = factor(g)
  ),
  alpha = 0.2,
  color = NA) +
  geom_hline(yintercept=0, color="dark grey") + xlab("") +
  labs(y = expression(paste(Delta, "MI (bits)")),
       x = "Stimulus firing rate (spks/s)",
       title = "ING") +
  lims(y=c(-0.8, 0.3)) +
  scale_color_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  scale_fill_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  theme_classic() +
  theme(strip.background = element_blank()) +
  theme(legend.background = element_rect(colour ="black")) +
  theme(legend.key.size = unit(.3, "cm")) +
  theme(panel.spacing = unit(1, "lines")) +
  theme(legend.position = "bottom") +
  theme(plot.title = element_text(size = 11, face = "bold")) +
  theme(strip.text.x = element_text(face = "bold")) ->
  p2

print(p2)

# ING - EI
tmp2 %>% 
  filter(num_pop < 10240) %>% 
  filter(model == "PING") %>% 
  filter(g_code == "g_EI") %>% 
  ggplot(aes(x=stim_rate,  y=M, color=factor(g), group=factor(g))) +
  geom_line(size=1.5, alpha=1) +
  geom_ribbon(aes(
    ymin = M - SD,
    ymax = M + SD,
    fill = factor(g)
  ),
  alpha = 0.2,
  color = NA) +
  geom_hline(yintercept=0, color="dark grey") + xlab("") +
  # scale_x_continuous(breaks=c(5,10,15,20,15,20,25,30)) +
  labs(y = expression(paste(Delta, "MI (bits)")),
       x = "Stimulus firing rate (spks/s)",
       title = "PING (E to I)") +
  lims(y=c(-0.8, 0.3)) +
  scale_color_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  scale_fill_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  theme_classic() +
  theme(strip.background = element_blank()) +
  theme(legend.background = element_rect(colour ="black")) +
  theme(legend.key.size = unit(.3, "cm")) +
  theme(panel.spacing = unit(1, "lines")) +
  theme(legend.position = "bottom") +
  theme(plot.title = element_text(size = 11, face = "bold")) +
  theme(strip.text.x = element_text(face = "bold")) ->
  p3
print(p3)

# ING - IE
tmp2 %>% 
  filter(num_pop < 10240) %>% 
  filter(model == "PING") %>% 
  filter(g_code == "g_IE") %>% 
  ggplot(aes(x=stim_rate,  y=M, color=factor(g), group=factor(g))) +
  geom_line(size=1.5, alpha=1) +
  geom_ribbon(aes(
    ymin = M - SD,
    ymax = M + SD,
    fill = factor(g)
  ),
  alpha = 0.2,
  color = NA) +
  geom_hline(yintercept=0, color="dark grey") + xlab("") +
  # scale_x_continuous(breaks=c(5,10,15,20,15,20,25,30)) +
  labs(y = expression(paste(Delta, "MI (bits)")),
       x = "Stimulus firing rate (spks/s)",
       title = "PING (I to E)") +
  lims(y=c(-0.8, 0.3)) +
  scale_color_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  scale_fill_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  theme_classic() +
  theme(strip.background = element_blank()) +
  theme(legend.background = element_rect(colour ="black")) +
  theme(legend.key.size = unit(.3, "cm")) +
  theme(panel.spacing = unit(1, "lines")) +
  theme(legend.position = "bottom") +
  theme(plot.title = element_text(size = 11, face = "bold")) +
  theme(strip.text.x = element_text(face = "bold")) ->
  p4
print(p4)

# ING - IE
tmp2 %>% 
  filter(num_pop < 10240) %>% 
  filter(model == "CHING") %>% 
  # filter(g_code == "g_E") %>% 
  ggplot(aes(x=stim_rate,  y=M, color=factor(g), group=factor(g))) +
  geom_line(size=1.5, alpha=1) +
  geom_ribbon(aes(
    ymin = M - SD,
    ymax = M + SD,
    fill = factor(g)
  ),
  alpha = 0.2,
  color = NA) +
  geom_hline(yintercept=0, color="dark grey") + xlab("") +
  # scale_x_continuous(breaks=c(5,10,15,20,15,20,25,30)) +
  labs(y = expression(paste(Delta, "MI (bits)")),
       x = "Stimulus firing rate (spks/s)",
       title = "CHING") +
  lims(y=c(-0.8, 0.3)) +
  scale_color_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  scale_fill_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  theme_classic() +
  theme(strip.background = element_blank()) +
  theme(legend.background = element_rect(colour ="black")) +
  theme(legend.key.size = unit(.3, "cm")) +
  theme(legend.position = "bottom") +
  theme(panel.spacing = unit(1, "lines")) +
  theme(plot.title = element_text(size = 11, face = "bold")) +
  theme(strip.text.x = element_text(face = "bold")) ->
  p5
print(p5)


# -----------------------------------------------
# Build figure
layout <- "
AABBBCCC
AABBBCCC
##DDDEEE
##DDDEEE
"

p1 + p2 + p5 + p3 + p4 +
  plot_annotation(
    tag_levels = 'a',
    tag_suffix = ".",
    title = "Population size: 160 or 1280",
    theme = theme(plot.title = element_text(size = 11, face = "bold"))
  ) +
  plot_layout(design = layout)
ggsave(
  "figures/circuit2.pdf",
  dpi = 300,
  width = 9,
  height = 8
)
ggsave(
  "figures/circuit2.png",
  dpi = 300,
  width = 9,
  height = 8
)
```

### Sig test results 
- For the paper.
```{r}
# compare_means(mi~model, tmp,  p.adjust.method = "bonf")
```

# Figure - large - circuit 3 
```{r, fig.width=9, fig.height=8, echo=FALSE, warning=FALSE, message=FALSE}
tmp1 <- NULL
tmp1 <- bind_rows(dmi_exp18, tmp1)
tmp1 <- bind_rows(dmi_exp20, tmp1)
tmp1 <- bind_rows(dmi_exp22, tmp1)
tmp1 <- bind_rows(dmi_exp24, tmp1)
tmp1$model <- factor(tmp1$model, levels=c("ING", "PING", "CHING"))

# -----------------------------------------------
# Jitter all
tmp %>% 
  filter(num_pop == 10240) %>% 
  ggplot(aes(x=model, y=E)) +
  geom_jitter(size=0.8, alpha=0.4, width=0.25) +
  stat_summary(aes(group=model), fun.y=mean,
               geom="point", colour="black", alpha=1, size=16, shape="_") +
  geom_hline(yintercept=0, color="dark grey", size=0.5) + xlab("") +
  labs(y=expression(paste(Delta, "MI (bits)")), x="Model", title="") +
  theme_classic() + 
  theme(plot.title = element_text(size = 7, hjust=3, face = "bold")) -> 
  p1
# print(p1)

# -----------------------------------------------
## stim_rate sequence

tmp1 %>%
  group_by(model, num_pop, g_code, g, stim_rate) %>%
  summarise(M=mean(E),
            SD=sd(E)) -> 
  tmp2
tmp2$model <- factor(tmp2$model, levels=c("ING", "PING", "CHING"))

# ING
tmp2 %>% 
  filter(num_pop == 10240) %>% 
  filter(model == "ING") %>% 
  ggplot(aes(x=stim_rate,  y=M, color=factor(g), group=factor(g))) +
  geom_line(size=1.5, alpha=1) +
  geom_ribbon(aes(
    ymin = M - SD,
    ymax = M + SD,
    fill = factor(g)
  ),
  alpha = 0.2,
  color = NA) +
  geom_hline(yintercept=0, color="dark grey") + xlab("") +
  labs(y = expression(paste(Delta, "MI (bits)")),
       x = "Stimulus firing rate (spks/s)",
       title = "ING") +
  lims(y=c(-0.8, 0.3)) +
  scale_color_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  scale_fill_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  theme_classic() +
  theme(strip.background = element_blank()) +
  theme(legend.background = element_rect(colour ="black")) +
  theme(legend.key.size = unit(.3, "cm")) +
  theme(panel.spacing = unit(1, "lines")) +
  theme(legend.position = "bottom") +
  theme(plot.title = element_text(size = 11, face = "bold")) +
  theme(strip.text.x = element_text(face = "bold")) ->
  p2
# print(p2)

# ING - EI
tmp2 %>% 
  filter(num_pop == 10240) %>% 
  filter(model == "PING") %>% 
  filter(g_code == "g_EI") %>% 
  ggplot(aes(x=stim_rate,  y=M, color=factor(g), group=factor(g))) +
  geom_line(size=1.5, alpha=1) +
  geom_ribbon(aes(
    ymin = M - SD,
    ymax = M + SD,
    fill = factor(g)
  ),
  alpha = 0.2,
  color = NA) +
  geom_hline(yintercept=0, color="dark grey") + xlab("") +
  # scale_x_continuous(breaks=c(5,10,15,20,15,20,25,30)) +
  labs(y = expression(paste(Delta, "MI (bits)")),
       x = "Stimulus firing rate (spks/s)",
       title = "PING (E to I)") +
  lims(y=c(-0.8, 0.3)) +
  scale_color_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  scale_fill_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  theme_classic() +
  theme(strip.background = element_blank()) +
  theme(legend.background = element_rect(colour ="black")) +
  theme(legend.key.size = unit(.3, "cm")) +
  theme(panel.spacing = unit(1, "lines")) +
  theme(legend.position = "bottom") +
  theme(plot.title = element_text(size = 11, face = "bold")) +
  theme(strip.text.x = element_text(face = "bold")) ->
  p3
# print(p3)

# ING - IE
tmp2 %>% 
  filter(num_pop == 10240) %>% 
  filter(model == "PING") %>% 
  filter(g_code == "g_IE") %>% 
  ggplot(aes(x=stim_rate,  y=M, color=factor(g), group=factor(g))) +
  geom_line(size=1.5, alpha=1) +
  geom_ribbon(aes(
    ymin = M - SD,
    ymax = M + SD,
    fill = factor(g)
  ),
  alpha = 0.2,
  color = NA) +
  geom_hline(yintercept=0, color="dark grey") + xlab("") +
  # scale_x_continuous(breaks=c(5,10,15,20,15,20,25,30)) +
  labs(y = expression(paste(Delta, "MI (bits)")),
       x = "Stimulus firing rate (spks/s)",
       title = "PING (I to E)") +
  lims(y=c(-0.8, 0.3)) +
  scale_color_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  scale_fill_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  theme_classic() +
  theme(strip.background = element_blank()) +
  theme(legend.background = element_rect(colour ="black")) +
  theme(legend.key.size = unit(.3, "cm")) +
  theme(panel.spacing = unit(1, "lines")) +
  theme(legend.position = "bottom") +
  theme(plot.title = element_text(size = 11, face = "bold")) +
  theme(strip.text.x = element_text(face = "bold")) ->
  p4
# print(p4)

# ING - IE
tmp2 %>% 
  filter(num_pop == 10240) %>% 
  filter(model == "CHING") %>% 
  # filter(g_code == "g_E") %>% 
  ggplot(aes(x=stim_rate,  y=M, color=factor(g), group=factor(g))) +
  geom_line(size=1.5, alpha=1) +
  geom_ribbon(aes(
    ymin = M - SD,
    ymax = M + SD,
    fill = factor(g)
  ),
  alpha = 0.2,
  color = NA) +
  geom_hline(yintercept=0, color="dark grey") + xlab("") +
  # scale_x_continuous(breaks=c(5,10,15,20,15,20,25,30)) +
  labs(y = expression(paste(Delta, "MI (bits)")),
       x = "Stimulus firing rate (spks/s)",
       title = "CHING") +
  lims(y=c(-0.8, 0.3)) +
  scale_color_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  scale_fill_manual("g", values = c(
    "lightsteelblue3",
    "lightskyblue3",
    "steelblue3",
    "steelblue4",
    "slateblue2", 
    "slateblue3",
    "slateblue4",
    "mediumpurple4",
    "darkorchid4"
    )) +
  theme_classic() +
  theme(strip.background = element_blank()) +
  theme(legend.background = element_rect(colour ="black")) +
  theme(legend.key.size = unit(.3, "cm")) +
  theme(legend.position = "bottom") +
  theme(panel.spacing = unit(1, "lines")) +
  theme(plot.title = element_text(size = 11, face = "bold")) +
  theme(strip.text.x = element_text(face = "bold")) ->
  p5
print(p5)


# -----------------------------------------------
# Build figure
layout <- "
AABBBCCC
AABBBCCC
##DDDEEE
##DDDEEE
"

p1 + p2 + p5 + p3 + p4 + 
  plot_annotation(
    tag_levels = 'a',
    tag_suffix = ".",
    title = "Population size: 10240",
    theme = theme(plot.title = element_text(size = 11, face = "bold"))
  ) +
  plot_layout(design = layout)
ggsave("figures/circuit3.pdf", dpi=300, width = 9, height = 8)
ggsave("figures/circuit3.png", dpi=300, width = 9, height = 8)
```


# Figure - Power 
## ^ TODO